# stella_vslam RGBD camera config for TurtleBot3 Waffle simulated D435i camera
# Intrinsics derived from gz_waffle.sdf.xacro (horizontal_fov=1.047, 320x240)
#
# Used with: slam_bridge.py --mode rgbd --config turtlebot_realsense.yaml
#
# Depth arrives as float32 metres from Gazebo (32FC1 encoding via Gz bridge).
# slam_bridge.py normalises all depth to float32 metres before sending to
# run_slam, so depthmap_factor is 1.0 for both simulation and real D435i.

Camera:
  name: "TurtleBot3 Waffle simulated D435i (RGBD)"
  setup: "RGBD"
  model: "perspective"

  # fx = fy = width / (2 * tan(hfov/2)) = 320 / (2 * tan(0.5235)) = 277.13
  fx: 277.13
  fy: 277.13
  cx: 160.0
  cy: 120.0

  # No distortion in simulation
  k1: 0.0
  k2: 0.0
  p1: 0.0
  p2: 0.0
  k3: 0.0

  fps: 5.0
  cols: 320
  rows: 240

  # slam_bridge.py delivers BGR frames (cv2 native ordering)
  color_order: "BGR"

  # depth_threshold: maximum depth in metres to use for mapping
  # Matches Gazebo depth camera far clip (gz_waffle.sdf.xacro: <far>5.0</far>)
  depth_threshold: 5.0

  # slam_bridge.py normalises depth to float32 metres; no additional scaling needed
  depthmap_factor: 1.0

Preprocessing:
  # min_size must be <= min(cols, rows) = 240
  min_size: 200

Feature:
  name: "ORB for low-res simulation camera"
  scale_factor: 1.2
  # Fewer pyramid levels for low resolution â€” avoids sub-pixel patches
  num_levels: 6
  # Lower thresholds to get enough features on simulated images
  ini_fast_threshold: 10
  min_fast_threshold: 3

Mapping:
  baseline_dist_thr: 0.1
  redundant_obs_ratio_thr: 0.9

SocketViewer:
  keyframe_size: 0.07
  keyframe_line_width: 1
  graph_line_width: 1
  point_size: 2
  camera_size: 0.08
  camera_line_width: 3
  viewpoint_x: 0
  viewpoint_y: -0.65
  viewpoint_z: -1.9
  viewpoint_f: 400
